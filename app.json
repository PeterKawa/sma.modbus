{
  "id": "sma.modbus",
  "sdk": 2,
  "brandColor": "#015a93",
  "name": {
    "en": "SMA Solar",
    "nl": "SMA Solar"
  },
  "tags": {
    "en": [
      "sma",
      "inverter",
      "solar",
      "sunny boy",
      "tripower",
      "pv",
      "energy",
      "energy meter",
      "home manager",
      "modbus"
    ],
    "nl": [
      "sma",
      "omvormer",
      "zonnepanelen",
      "sunny boy",
      "tripower",
      "pv",
      "energie",
      "energie meter",
      "home manager",
      "modbus"
    ]
  },
  "version": "2.0.2",
  "compatibility": ">=3.0.0",
  "author": {
    "name": "Richard Barkestam",
    "email": "richard@barkestam.se"
  },
  "contributors": {
    "developers": [
      {
        "name": "Richard Barkestam",
        "email": "richard@barkestam.se"
      },
      {
        "name": "Jelger Haanstra",
        "email": "homey@solidewebservices.com"
      }
    ]
  },
  "contributing": {
    "donate": {
      "paypal": {
        "username": "RBarkestam",
        "currency": "EUR"
      }
    }
  },
  "bugs": {
    "url": "https://github.com/ricott/sma.modbus/issues"
  },
  "source": "https://github.com/ricott/sma.modbus",
  "homeyCommunityTopicId": 696,
  "images": {
    "large": "./assets/images/large.png",
    "small": "./assets/images/small.png"
  },
  "category": "energy",
  "description": {
    "en": "Monitor your SMA Solar devices"
  },
  "dependencies": {
    "net": "*"
  },
  "capabilities": {
    "measure_yield": {
      "type": "number",
      "title": {
        "en": "Total Yield",
        "nl": "Totale opbrengst"
      },
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "/assets/total_yield.svg",
      "units": {
        "en": "MWh",
        "nl": "MWh"
      }
    },
    "operational_status": {
      "type": "string",
      "title": {
        "en": "Operational Status",
        "nl": "Operationele status"
      },
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "/assets/operational_status.svg"
    },
    "battery": {
      "type": "number",
      "title": {
        "en": "Battery Charge",
        "nl": "Batterij lading"
      },
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "/assets/battery.svg",
      "units": {
        "en": "%",
        "nl": "%"
      }
    },
    "power_drawn": {
      "type": "number",
      "title": {
        "en": "Power Drawn",
        "nl": "Stroom afname"
      },
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "/assets/power_drawn.svg",
      "units": {
        "en": "W",
        "nl": "W"
      }
    },
    "powergrid_feed_in": {
      "type": "number",
      "title": {
        "en": "Powergrid Feed In",
        "nl": "Vermogen netvoeding"
      },
      "insights": true,
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "/assets/powergrid_feed_in.svg",
      "units": {
        "en": "W",
        "nl": "W"
      }
    },
    "battery_capacity": {
      "type": "number",
      "title": {
        "en": "Battery Capacity",
        "nl": "Batterij capaciteit"
      },
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "/assets/battery_capacity.svg",
      "units": {
        "en": "%",
        "nl": "%"
      }
    },
    "power_grid": {
      "type": "number",
      "title": {
        "en": "Grid power"
      },
      "insights": false,
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "/assets/grid.svg",
      "units": {
        "en": "W",
        "nl": "W"
      }
    },
    "power_pv": {
      "type": "number",
      "title": {
        "en": "PV power"
      },
      "insights": false,
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "/assets/sun2.svg",
      "units": {
        "en": "W",
        "nl": "W"
      }
    },
    "power_self": {
      "type": "number",
      "title": {
        "en": "Consumption"
      },
      "insights": false,
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "/assets/house.svg",
      "units": {
        "en": "W",
        "nl": "W"
      }
    }
  },
  "drivers": [
    {
      "id": "inverter",
      "name": {
        "en": "Inverter",
        "nl": "Omvormer"
      },
      "images": {
        "large": "drivers/inverter/assets/images/large.png",
        "small": "drivers/inverter/assets/images/small.png"
      },
      "class": "solarpanel",
      "capabilities": [
        "operational_status.health",
        "operational_status",
        "measure_voltage.dcA",
        "measure_voltage.dcB",
        "measure_power",
        "measure_voltage",
        "meter_power",
        "measure_yield"
      ],
      "capabilitiesOptions": {
        "operational_status.health": {
          "title": {
            "en": "Condition",
            "nl": "Staat"
          }
        },
        "measure_voltage.dcA": {
          "title": {
            "en": "MPP A (DC)",
            "nl": "MPP A (DC)"
          }
        },
        "measure_voltage.dcB": {
          "title": {
            "en": "MPP B (DC)",
            "nl": "MPP B (DC)"
          }
        },
        "measure_power": {
          "title": {
            "en": "Grid power",
            "nl": "Netvermogen"
          }
        },
        "measure_voltage": {
          "title": {
            "en": "Grid voltage (L1)",
            "nl": "Netspanning (L1)"
          }
        },
        "meter_power": {
          "title": {
            "en": "Daily Yield",
            "nl": "Dagelijkse opbrengst"
          }
        }
      },
      "pair": [
        {
          "id": "list_devices",
          "template": "list_devices",
          "navigation": {
            "next": "add_devices"
          }
        },
        {
          "id": "add_devices",
          "template": "add_devices"
        }
      ],
      "settings": [
        {
          "type": "group",
          "label": {
            "en": "Inverter settings",
            "nl": "Omvormer instellingen"
          },
          "children": [
            {
              "id": "address",
              "type": "text",
              "value": "0.0.0.0",
              "label": {
                "en": "IP Address",
                "nl": "IP adres"
              }
            },
            {
              "id": "port",
              "type": "number",
              "value": 502,
              "step": 1,
              "label": {
                "en": "Port",
                "nl": "Poort"
              }
            },
            {
              "id": "polling",
              "type": "number",
              "value": 5,
              "step": 1,
              "attr": {
                "min": 2,
                "max": 3600
              },
              "label": {
                "en": "Polling",
                "nl": "Polling"
              }
            }
          ]
        },
        {
          "type": "group",
          "label": {
            "en": "Information",
            "nl": "Informatie"
          },
          "children": [
            {
              "id": "deviceType",
              "type": "label",
              "label": {
                "en": "Device type",
                "nl": "Soort apparaat"
              },
              "value": ""
            },
            {
              "id": "serialNo",
              "type": "label",
              "label": {
                "en": "Serial number",
                "nl": "Serienummer"
              },
              "value": ""
            },
            {
              "id": "swVersion",
              "type": "label",
              "label": {
                "en": "Software version",
                "nl": "Software versie"
              },
              "value": ""
            },
            {
              "id": "maxPower",
              "type": "label",
              "label": {
                "en": "Max power (W)",
                "nl": "Max vermogen (W)"
              },
              "value": ""
            },
            {
              "id": "activePowerLimit",
              "type": "label",
              "label": {
                "en": "Active power limit (W)",
                "nl": "Actief vermogen limiet (W)"
              },
              "value": ""
            },
            {
              "id": "gridCountry",
              "type": "label",
              "label": {
                "en": "Grid country standard"
              },
              "value": ""
            }
          ]
        },
        {
          "type": "group",
          "label": {
            "en": "Debug",
            "nl": "Debug"
          },
          "children": [
            {
              "id": "sma_last_error",
              "type": "textarea",
              "label": {
                "en": "Most recent SMA Error",
                "nl": "Meest recente SMA-fout"
              },
              "value": ""
            }
          ]
        }
      ]
    },
    {
      "id": "storage",
      "name": {
        "en": "Sunny Boy Storage",
        "nl": "Sunny Boy Storage"
      },
      "images": {
        "large": "drivers/storage/assets/images/large.jpg",
        "small": "drivers/storage/assets/images/small.jpg"
      },
      "class": "sensor",
      "capabilities": [
        "operational_status",
        "battery",
        "measure_power.charge",
        "measure_power.discharge",
        "power_drawn",
        "powergrid_feed_in",
        "battery_capacity"
      ],
      "capabilitiesOptions": {
        "measure_power.charge": {
          "title": {
            "en": "Charge",
            "nl": "Opladen"
          }
        },
        "measure_power.discharge": {
          "title": {
            "en": "Discharge",
            "nl": "Ontladen"
          }
        }
      },
      "pair": [
        {
          "id": "start"
        }
      ],
      "settings": [
        {
          "type": "group",
          "label": {
            "en": "Sunny Boy Storage settings",
            "nl": "Sunny Boy Storage instellingen"
          },
          "children": [
            {
              "id": "address",
              "type": "text",
              "value": "0.0.0.0",
              "label": {
                "en": "IP Address",
                "nl": "IP adres"
              }
            },
            {
              "id": "port",
              "type": "number",
              "value": 502,
              "step": 1,
              "label": {
                "en": "Port",
                "nl": "Poort"
              }
            },
            {
              "id": "polling",
              "type": "number",
              "value": 10,
              "step": 1,
              "attr": {
                "min": 2,
                "max": 3600
              },
              "label": {
                "en": "Polling",
                "nl": "Polling"
              }
            }
          ]
        }
      ]
    },
    {
      "id": "energy",
      "name": {
        "en": "Energy Meter"
      },
      "images": {
        "large": "drivers/energy/assets/images/large.png",
        "small": "drivers/energy/assets/images/small.png"
      },
      "class": "sensor",
      "capabilities": [
        "measure_power",
        "measure_power.surplus",
        "measure_power.L1",
        "measure_current.L1",
        "measure_power.L2",
        "measure_current.L2",
        "measure_power.L3",
        "measure_current.L3"
      ],
      "capabilitiesOptions": {
        "measure_power": {
          "title": {
            "en": "Grid power"
          }
        },
        "measure_power.surplus": {
          "title": {
            "en": "Grid feed-in"
          }
        },
        "measure_power.L1": {
          "title": {
            "en": "L1 power"
          }
        },
        "measure_current.L1": {
          "title": {
            "en": "L1 current"
          }
        },
        "measure_power.L2": {
          "title": {
            "en": "L2 power"
          }
        },
        "measure_current.L2": {
          "title": {
            "en": "L2 current"
          }
        },
        "measure_power.L3": {
          "title": {
            "en": "L3 power"
          }
        },
        "measure_current.L3": {
          "title": {
            "en": "L3 current"
          }
        }
      },
      "energy": {
        "cumulative": true
      },
      "pair": [
        {
          "id": "list_devices",
          "template": "list_devices",
          "navigation": {
            "next": "add_devices"
          }
        },
        {
          "id": "add_devices",
          "template": "add_devices"
        }
      ],
      "settings": [
        {
          "type": "group",
          "label": {
            "en": "Emergy Meter settings",
            "nl": "Omvormer instellingen"
          },
          "children": [
            {
              "id": "polling",
              "type": "number",
              "value": 5,
              "step": 1,
              "attr": {
                "min": 2,
                "max": 3600
              },
              "label": {
                "en": "Poll interval",
                "nl": "Polling"
              }
            }
          ]
        },
        {
          "type": "group",
          "label": {
            "en": "Load balancing"
          },
          "children": [
            {
              "id": "mainFuse",
              "type": "number",
              "value": 20,
              "step": 1,
              "attr": {
                "min": 1,
                "max": 100
              },
              "label": {
                "en": "Main fuse (A)"
              },
              "hint": {
                "en": "Main fuse of your property, typically 16, 20, 25, 32 etc."
              }
            },
            {
              "id": "threshold",
              "type": "number",
              "value": 95,
              "step": 1,
              "attr": {
                "min": 1,
                "max": 120
              },
              "label": {
                "en": "Trigger threshold (%)"
              },
              "hint": {
                "en": "At what utilization in percentage should the phase utilization alert trigger fire"
              }
            },
            {
              "id": "offset",
              "type": "number",
              "value": 2,
              "step": 1,
              "attr": {
                "min": 0,
                "max": 100
              },
              "label": {
                "en": "Available current offset (A)"
              },
              "hint": {
                "en": "The available current is calculated from the most utilized phase vs main fuse. This offset field gives possibility to decrease available current to give some margin."
              }
            }
          ]
        },
        {
          "type": "group",
          "label": {
            "en": "Information",
            "nl": "Informatie"
          },
          "children": [
            {
              "id": "serialNo",
              "type": "label",
              "label": {
                "en": "Serial number",
                "nl": "Serienummer"
              },
              "value": ""
            }
          ]
        },
        {
          "type": "group",
          "label": {
            "en": "Debug",
            "nl": "Debug"
          },
          "children": [
            {
              "id": "sma_last_error",
              "type": "textarea",
              "label": {
                "en": "Most recent SMA Error",
                "nl": "Meest recente SMA-fout"
              },
              "value": ""
            }
          ]
        }
      ]
    },
    {
      "id": "summary",
      "name": {
        "en": "Energy summary"
      },
      "images": {
        "large": "drivers/summary/assets/images/large.png",
        "small": "drivers/summary/assets/images/small.png"
      },
      "class": "sensor",
      "capabilities": [
        "power_pv",
        "power_grid",
        "power_drawn.battery",
        "power_self"
      ],
      "capabilitiesOptions": {
        "power_drawn.battery": {
          "title": {
            "en": "Battery power"
          }
        }
      },
      "pair": [
        {
          "id": "list_devices",
          "template": "list_devices",
          "navigation": {
            "next": "add_devices"
          }
        },
        {
          "id": "add_devices",
          "template": "add_devices"
        }
      ],
      "settings": [
        {
          "type": "group",
          "label": {
            "en": "Inverter settings",
            "nl": "Omvormer instellingen"
          },
          "children": [
            {
              "id": "polling",
              "type": "number",
              "value": 5,
              "step": 1,
              "attr": {
                "min": 2,
                "max": 3600
              },
              "label": {
                "en": "Polling",
                "nl": "Polling"
              }
            }
          ]
        }
      ]
    }
  ],
  "flow": {
    "triggers": [
      {
        "id": "phase_threshold_triggered",
        "title": {
          "en": "Phase utilization alert"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=energy"
          }
        ],
        "tokens": [
          {
            "name": "phase",
            "type": "string",
            "title": {
              "en": "Phase"
            },
            "example": {
              "en": "L1"
            }
          },
          {
            "name": "percentageUtilized",
            "type": "number",
            "title": {
              "en": "Utilized (%)"
            },
            "example": {
              "en": "98"
            }
          }
        ]
      },
      {
        "id": "inverter_status_changed",
        "title": {
          "en": "Operational Status Changed",
          "nl": "Operationele status gewijzigd"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=inverter"
          }
        ],
        "tokens": [
          {
            "name": "inverter_status",
            "type": "string",
            "title": {
              "en": "Operational Status",
              "nl": "Operationele status"
            },
            "example": {
              "en": "MPP"
            }
          }
        ]
      },
      {
        "id": "changedOperationalStatus",
        "title": {
          "en": "Operational Status Changed",
          "nl": "Operationele status gewijzigd"
        },
        "tokens": [
          {
            "name": "status",
            "type": "string",
            "title": {
              "en": "Operational Status",
              "nl": "Operationele status"
            },
            "example": "Battery Standby"
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "placeholder": {
              "en": "Select Sunny Boy Storage",
              "nl": "Selecteer  Sunny Boy Storage"
            },
            "filter": "driver_id=storage"
          }
        ]
      },
      {
        "id": "changedBattery",
        "title": {
          "en": "Battery Charge Changed",
          "nl": "Batterij lading gewijzigd"
        },
        "tokens": [
          {
            "name": "charge",
            "type": "number",
            "title": {
              "en": "Battery Charge (%)",
              "nl": "Batterij lading (%)"
            },
            "example": 66
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "placeholder": {
              "en": "Select Sunny Boy Storage",
              "nl": "Selecteer  Sunny Boy Storage"
            },
            "filter": "driver_id=storage"
          }
        ]
      },
      {
        "id": "changedBatteryCharging",
        "title": {
          "en": "Battery Charging Changed (W)",
          "nl": "Batterij opladen gewijzigd (W)"
        },
        "tokens": [
          {
            "name": "charging",
            "type": "number",
            "title": {
              "en": "Battery Charging (W)",
              "nl": "Batterij opladen (W)"
            },
            "example": 1337
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "placeholder": {
              "en": "Select Sunny Boy Storage",
              "nl": "Selecteer  Sunny Boy Storage"
            },
            "filter": "driver_id=storage"
          }
        ]
      },
      {
        "id": "changedBatteryDischarging",
        "title": {
          "en": "Battery Discharging Changed (W)",
          "nl": "Batterij ontladen gewijzigd (W)"
        },
        "tokens": [
          {
            "name": "discharging",
            "type": "number",
            "title": {
              "en": "Battery Discharging (W)",
              "nl": "Batterij ontladen (W)"
            },
            "example": 187
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "placeholder": {
              "en": "Select Sunny Boy Storage",
              "nl": "Selecteer  Sunny Boy Storage"
            },
            "filter": "driver_id=storage"
          }
        ]
      },
      {
        "id": "changedPowerDrawn",
        "title": {
          "en": "Power Drawn Changed (W)",
          "nl": "Stroom afname gewijzigd (W)"
        },
        "tokens": [
          {
            "name": "drawn",
            "type": "number",
            "title": {
              "en": "Power Drawn (W)",
              "nl": "Stroom afname (W)"
            },
            "example": 303
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "placeholder": {
              "en": "Select Sunny Boy Storage",
              "nl": "Selecteer  Sunny Boy Storage"
            },
            "filter": "driver_id=storage"
          }
        ]
      },
      {
        "id": "changedPowerGridFeedin",
        "title": {
          "en": "Powergrid Feed In Changed (W)",
          "nl": "Vermogen netvoeding gewijzigd (W)"
        },
        "tokens": [
          {
            "name": "feedin",
            "type": "number",
            "title": {
              "en": "Powergrid Feed In (W)",
              "nl": "Vermogen netvoeding (W)"
            },
            "example": 42
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "placeholder": {
              "en": "Select Sunny Boy Storage",
              "nl": "Selecteer  Sunny Boy Storage"
            },
            "filter": "driver_id=storage"
          }
        ]
      },
      {
        "id": "changedBatteryCapacity",
        "title": {
          "en": "Battery Capacity Changed (%",
          "nl": "Batterij capaciteit gewijzigd (%)"
        },
        "tokens": [
          {
            "name": "capacity",
            "type": "number",
            "title": {
              "en": "Battery Capacity (%)",
              "nl": "Batterij capaciteit (%)"
            },
            "example": 42
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "placeholder": {
              "en": "Select Sunny Boy Storage",
              "nl": "Selecteer  Sunny Boy Storage"
            },
            "filter": "driver_id=storage"
          }
        ]
      }
    ],
    "conditions": [
      {
        "id": "isInverterDailyYield",
        "title": {
          "en": "Daily yield is !{{|not}} above"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=inverter"
          },
          {
            "name": "daily_yield",
            "type": "number",
            "title": {
              "en": "Daily yield (kWh)"
            }
          }
        ]
      },
      {
        "id": "isInverterStatus",
        "title": {
          "en": "Operational status !{{contains|doesn't contain}}"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=inverter"
          },
          {
            "name": "inverter_status",
            "type": "text",
            "title": {
              "en": "Operational status"
            }
          }
        ]
      },
      {
        "id": "isOperationalStatus",
        "title": {
          "en": "Operation status !{{is|is not}}",
          "nl": "Operationele status !{{is|is niet}}"
        },
        "args": [
          {
            "name": "status",
            "type": "dropdown",
            "values": [
              {
                "id": "303",
                "label": {
                  "en": "Off",
                  "nl": "Uit"
                }
              },
              {
                "id": "2291",
                "label": {
                  "en": "Battery Standby",
                  "nl": "Batterij standby"
                }
              },
              {
                "id": "2292",
                "label": {
                  "en": "Battery Charging",
                  "nl": "Batterij opladen"
                }
              },
              {
                "id": "2293",
                "label": {
                  "en": "Battery Discharging",
                  "nl": "Batterij ontladen"
                }
              },
              {
                "id": "16777213",
                "label": {
                  "en": "Information Not Available",
                  "nl": "Informatie Niet Beschikbaar"
                }
              }
            ]
          },
          {
            "name": "device",
            "type": "device",
            "placeholder": {
              "en": "Select Sunny Boy Storage",
              "nl": "Selecteer  Sunny Boy Storage"
            },
            "filter": "driver_id=storage"
          }
        ]
      },
      {
        "id": "phaseUtilized",
        "title": {
          "en": "A phase utilized !{{above|below}}"
        },
        "args": [
          {
            "name": "phase",
            "type": "dropdown",
            "values": [
              {
                "id": "L1",
                "label": {
                  "en": "L1"
                }
              },
              {
                "id": "L2",
                "label": {
                  "en": "L2"
                }
              },
              {
                "id": "L3",
                "label": {
                  "en": "L3"
                }
              }
            ]
          },
          {
            "name": "utilization",
            "type": "number",
            "title": {
              "en": "Utilization (%)"
            }
          },
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=energy"
          }
        ]
      },
      {
        "id": "anyPhaseUtilized",
        "title": {
          "en": "Any phase utilized !{{above|below}}"
        },
        "args": [
          {
            "name": "utilization",
            "type": "number",
            "title": {
              "en": "Utilization (%)"
            }
          },
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=energy"
          }
        ]
      }
    ]
  }
}